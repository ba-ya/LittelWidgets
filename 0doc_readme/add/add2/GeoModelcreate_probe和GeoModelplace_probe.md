

1. **`GeoModel::create_probe`：**

   - 这个函数用于创建探测器的几何模型。它接受一系列参数，包括探测器的高度、长度、宽度、角度等，然后返回一个表示探测器几何特征的对象或数据结构。

     是的，根据函数 `create_probe` 的实现，确实可以推断出 `array` 这个部分是与晶片（或阵列）相关的，代表了晶片的一些属性。以下是对该函数主要步骤的解释：

     1. **创建 `ArrayRect` 对象：**
        - 通过 `std::make_shared<ArrayRect>()` 创建了一个名为 `array` 的 `ArrayRect` 对象。`ArrayRect` 可能是用于表示矩形阵列的类。（rect通常指的是Rectangle）

     2. **创建 `Wedge` 对象：**
        - 通过 `std::make_shared<Wedge>()` 创建了一个名为 `wedge` 的 `Wedge` 对象。`Wedge` 可能是用于表示楔块的类。

     3. **设置 `wedge` 的几何属性：**
        - 设置 `wedge` 的长度、宽度属性。

     4. **创建 `CoordSys` 对象 `c_sys_w` 和 `ModelWedgeRoof` 对象 `w`：**
        - 通过 `std::make_shared<CoordSys>()` --*坐标系（Coordinate System）的类*
        -  `std::make_shared<ModelWedgeRoof>()` 创建了两个对象。--*表示楔块的一个模型，其中"Roof"可能指的是楔块的形状有屋顶状。这个类可能包含设置楔块几何特征、角度属性以及传感器位置的方法和属性。*
        - 在 `w` 中设置了楔块的几何属性、角度属性和传感器的位置。

     5. **获取楔块 `w` 的顶点信息：**
        - 通过 `w->get_vertex(*vertex_w)` 获取了楔块 `w` 的顶点信息，并将其存储在 `wedge->pw` 中。

     6. **设置楔块 `wedge` 的坐标系信息：**
        - 将 `w` 中的坐标系信息分别赋值给 `wedge->ca_1`、`wedge->ca_2` 和 `wedge->ca_3`。

     7. **创建 `ModelArrayRect` 对象 `arr`：**
        - 通过 `std::make_shared<ModelArrayRect>()` 创建了一个对象，可能用于表示矩形阵列的类。

     8. **设置矩形阵列的属性：**
        - 设置矩形阵列的维度、元素大小、元素之间的间隔等属性。

     9. **获取矩形阵列 `arr` 的顶点信息：**
        - 通过 `arr->get_vertex(w->c_sys_1, *vertex_t)` 获取了矩形阵列 `arr` 的顶点信息，并将其存储在 `wedge->pa` 中。

     10. **设置 `array` 的属性：**

        - 将晶片数量、阵列的步进等信息存储在 `array` 对象中。

     11. **创建 `ProbeWARect` 对象 `p`：**
         - 通过 `std::make_shared<ProbeWARect>()` 创建了一个对象，可能用于表示矩形阵列的探测器类。

     12. **将 `array`、`wedge` 存储在 `p` 中并返回 `p`：**
         - 将之前创建的 `array` 和 `wedge` 对象存储在 `p` 中，并将 `p` 返回。

     综上，`array` 代表了晶片或阵列的一些属性，包括数量、步进等。这个函数主要用于创建一个探测器对象，该对象包含了一个阵列和一个楔块，并返回了该探测器对象的共享指针。

2. **`GeoModel::place_probe`：**

   - 函数的行为取决于参数 `scan_circle` 的值。如果 `scan_circle` 为 `true`，则表示探测器将在管道的圆周上进行扫描，否则将在管道的纵向上进行扫描。以下是该函数的大致流程：

     1. **创建坐标系 `cw`：**
        - 创建一个坐标系 `cw`，这个坐标系用于表示探测器的位置和朝向。
     2. **计算旋转角度 `a`：**
        - 如果是在圆周上扫描，计算旋转角度 `a`，并根据 `a` 创建旋转矩阵 `rot`。
     3. **计算坐标系 `cw` 中的位置：**
        - 根据计算的旋转角度、偏移量 `apart_x`、管道半径 `r` 等参数计算 `cw` 中的位置坐标。
     4. **创建探测器的 VTK Actor：**
        - 清除探测器的 VTK Actor（如果存在）。
        - 调用 `create_actor_wedge` 和 `create_actor_trans_array` 函数创建探测器的 VTK Actor，这可能是用于在可视化窗口中显示探测器的几何形状。
     5. **更新探测器的坐标系信息和扫描类型：**
        - 将计算得到的坐标系 `cw` 赋值给探测器。
        - 设置管道的扫描类型为在圆周上进行扫描。

     或者，如果 `scan_circle` 为 `false`，则表示探测器将在管道的纵向上进行扫描：

     1. **创建坐标系 `cw`：**
        - 同上。
     2. **计算旋转角度 `a1` 和 `a2`：**
        - 如果是在纵向上扫描，计算两个旋转角度 `a1` 和 `a2`，并根据它们创建旋转矩阵 `rot`。
     3. **计算坐标系 `cw` 中的位置：**
        - 根据计算的旋转角度、偏移量 `apart_x`、管道半径 `r` 等参数计算 `cw` 中的位置坐标。
     4. **创建探测器的 VTK Actor：**
        - 同上。
     5. **更新探测器的坐标系信息和扫描类型：**
        - 将计算得到的坐标系 `cw` 赋值给探测器。
        - 设置管道的扫描类型为在纵向上进行扫描。

     这个函数主要用于控制探测器的位置、朝向和扫描方式，以便在仿真或可视化中模拟探测器的运动。