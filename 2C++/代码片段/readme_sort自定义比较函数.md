```c++
vector<tuple<int, int, int>> data;
ranges::sort(data, {}, [](auto t) {return tuple{get<0>(t), -get<1>(t), get<2>(t)};});
```

```c++
vector<vector<int>>& envelopes;
ranges::sort(envelopes, {}, [](vector<int> e) {return pair{e[0], -e[1]};});
```

æˆ‘ä»¬æ¥ç³»ç»Ÿåœ°è§£é‡Š C++ ä¸­ **`std::sort`** å’Œ **`std::ranges::sort`** çš„å‚æ•°å«ä¹‰ï¼Œç‰¹åˆ«æ˜¯ä½ å…³å¿ƒçš„å¸¦ **æ¯”è¾ƒå™¨ï¼ˆcomparatorï¼‰** å’Œ **æŠ•å½±ï¼ˆprojectionï¼‰** çš„ç”¨æ³•ã€‚

------

## ğŸŒŸ ä¸€ã€ä¼ ç»Ÿ `std::sort`ï¼ˆC++98 èµ·ï¼‰

### âœ… å‡½æ•°ç­¾å

```cpp
template< class RandomIt, class Compare >
void sort( RandomIt first, RandomIt last, Compare comp );
```

### ğŸ”¹ å‚æ•°è¯´æ˜

| å‚æ•°    | å«ä¹‰                                       |
| ------- | ------------------------------------------ |
| `first` | å®¹å™¨èµ·å§‹è¿­ä»£å™¨ï¼ˆå¦‚ `vec.begin()`ï¼‰         |
| `last`  | å®¹å™¨ç»“æŸè¿­ä»£å™¨ï¼ˆå¦‚ `vec.end()`ï¼‰           |
| `comp`  | **å¯é€‰**çš„æ¯”è¾ƒå‡½æ•°ï¼ˆäºŒå…ƒè°“è¯ï¼‰ï¼Œé»˜è®¤æ˜¯ `<` |

### ğŸ”¸ æ¯”è¾ƒå‡½æ•° `comp(a, b)` å¿…é¡»æ»¡è¶³ï¼š

- è¿”å› `true` è¡¨ç¤º **`a` åº”è¯¥æ’åœ¨ `b` å‰é¢**
- ä¾‹å¦‚ï¼š`[](int a, int b) { return a < b; }` â†’ å‡åº

### âœ… ç¤ºä¾‹

```cpp
vector<int> v = {3, 1, 4};
sort(v.begin(), v.end()); // é»˜è®¤å‡åº

sort(v.begin(), v.end(), [](int a, int b) {
    return a > b; // é™åº
});
```

> â— æ³¨æ„ï¼šä¼ ç»Ÿ `sort` **æ²¡æœ‰â€œæŠ•å½±â€å‚æ•°**ï¼

------

## ğŸŒŸ äºŒã€ç°ä»£ `std::ranges::sort`ï¼ˆC++20 èµ·ï¼‰

è¿™æ˜¯æ›´å¼ºå¤§ã€æ›´ç®€æ´çš„ç‰ˆæœ¬ï¼Œæ”¯æŒ **æŠ•å½±ï¼ˆprojectionï¼‰**ã€‚

### âœ… å‡½æ•°ç­¾åï¼ˆç®€åŒ–ï¼‰

```cpp
template< ranges::random_access_range R, class Comp = ranges::less, class Proj = identity >
void sort( R&& r, Comp comp = {}, Proj proj = {} );
```

### ğŸ”¹ å‚æ•°è¯´æ˜

| å‚æ•°   | å«ä¹‰                         | é»˜è®¤å€¼                          |
| ------ | ---------------------------- | ------------------------------- |
| `r`    | è¦æ’åºçš„**èŒƒå›´**ï¼ˆå¦‚ `vec`ï¼‰ | â€”                               |
| `comp` | **æ¯”è¾ƒå‡½æ•°**ï¼ˆäºŒå…ƒè°“è¯ï¼‰     | `std::ranges::less{}`ï¼ˆå³ `<`ï¼‰ |
| `proj` | **æŠ•å½±å‡½æ•°**ï¼ˆä¸€å…ƒå‡½æ•°ï¼‰     | `std::identity{}`ï¼ˆå³åŸæ ·è¿”å›ï¼‰ |

------

### ğŸ”¸ å…³é”®æ¦‚å¿µï¼š**æŠ•å½±ï¼ˆProjectionï¼‰**

> æŠ•å½±çš„ä½œç”¨æ˜¯ï¼š**åœ¨æ¯”è¾ƒå‰ï¼Œå…ˆæŠŠæ¯ä¸ªå…ƒç´ â€œè½¬æ¢â€æˆå¦ä¸€ä¸ªå€¼ï¼Œç„¶åå¯¹è¿™ä¸ªâ€œè½¬æ¢åçš„å€¼â€è¿›è¡Œæ¯”è¾ƒã€‚**

ç­‰ä»·äºï¼š

```cpp
// ä¼ªä»£ç 
if (comp(proj(a), proj(b))) {
    // a æ’åœ¨ b å‰é¢
}
```

è¿™é¿å…äº†å†™å¤æ‚çš„æ¯”è¾ƒå‡½æ•°ï¼

------

## âœ… ä¸‰ã€ç»å…¸ä¾‹å­å¯¹æ¯”

### åœºæ™¯ï¼šå¯¹ `vector<pair<int, string>>` æŒ‰ `second`ï¼ˆå­—ç¬¦ä¸²ï¼‰æ’åº

#### æ–¹æ³• 1ï¼šä¼ ç»Ÿ `sort`ï¼ˆå†™å®Œæ•´æ¯”è¾ƒå‡½æ•°ï¼‰

```cpp
sort(v.begin(), v.end(), [](const auto& a, const auto& b) {
    return a.second < b.second;
});
```

#### æ–¹æ³• 2ï¼š`ranges::sort` + æŠ•å½±ï¼ˆæ›´ç®€æ´ï¼‰

```cpp
ranges::sort(v, {}, &pair<int,string>::second);
// æˆ–
ranges::sort(v, {}, [](const auto& x) { return x.second; });
```

âœ… æŠ•å½±æŠŠæ¯ä¸ª `pair` æ˜ å°„ä¸ºå®ƒçš„ `.second`ï¼Œç„¶åç”¨é»˜è®¤ `<` æ¯”è¾ƒå­—ç¬¦ä¸²ã€‚

------

## âœ… å››ã€å›åˆ°ä½ çš„é—®é¢˜ï¼šä¸‰ä¸ªå‚æ•°çš„å«ä¹‰

```cpp
ranges::sort(data, {}, [](auto t) { return tuple{...}; });
```

| å‚æ•°ä½ç½® | å®é™…ä¼ å…¥ | å«ä¹‰                                          |
| -------- | -------- | --------------------------------------------- |
| ç¬¬1ä¸ª    | `data`   | è¦æ’åºçš„å®¹å™¨ï¼ˆèŒƒå›´ï¼‰                          |
| ç¬¬2ä¸ª    | `{}`     | æ¯”è¾ƒå™¨ `comp`ï¼Œ`{}` è¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„ `<`        |
| ç¬¬3ä¸ª    | `lambda` | æŠ•å½±å‡½æ•° `proj`ï¼Œå°†æ¯ä¸ªå…ƒç´ æ˜ å°„ä¸ºç”¨äºæ¯”è¾ƒçš„å€¼ |

> ğŸ’¡ æ‰€ä»¥æ•´è¡Œçš„æ„æ€æ˜¯ï¼š
> â€œæŠŠ `data` ä¸­æ¯ä¸ªå…ƒç´  `t` ç”¨ lambda è½¬æ¢æˆä¸€ä¸ª `tuple`ï¼Œç„¶åæŒ‰è¿™ä¸ª `tuple` çš„**é»˜è®¤å­—å…¸åº**æ’åºâ€

------

## âœ… äº”ã€å¸¸è§å†™æ³•æ€»ç»“

| éœ€æ±‚              | å†™æ³•                                                         |
| ----------------- | ------------------------------------------------------------ |
| é»˜è®¤æ’åº          | `ranges::sort(v);`                                           |
| è‡ªå®šä¹‰æ¯”è¾ƒ        | `ranges::sort(v, [](auto a, auto b) { return ...; });`       |
| æŠ•å½±æ’åº          | `ranges::sort(v, {}, [](auto x) { return x.field; });`       |
| æŠ•å½± + è‡ªå®šä¹‰æ¯”è¾ƒ | `ranges::sort(v, greater{}, [](auto x) { return x.value; });` |

------

## âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹

1. **æŠ•å½±å‡½æ•°å¿…é¡»æ˜¯ä¸€å…ƒå‡½æ•°**ï¼ˆæ¥å—ä¸€ä¸ªå‚æ•°ï¼‰
2. **æ¯”è¾ƒå‡½æ•°å¿…é¡»æ˜¯äºŒå…ƒè°“è¯**ï¼ˆæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œè¿”å› boolï¼‰
3. **`{}` æ˜¯ `std::ranges::less{}` çš„ç®€å†™**ï¼ˆé»˜è®¤å‡åºï¼‰
4. **æŠ•å½±å¸¸ç”¨äºé¿å…é‡å¤é€»è¾‘**ï¼Œæ¯”å¦‚å–æˆå‘˜ã€å–è´Ÿã€ç»„åˆå­—æ®µç­‰

------

## âœ… ä¸ƒã€å®æˆ˜ï¼šä¿¡å°æ’åºï¼ˆLeetCode 354ï¼‰

```cpp
vector<vector<int>> envelopes;
ranges::sort(envelopes, {}, [](const auto& e) {
    return pair(e[0], -e[1]); // å®½å‡åºï¼Œé«˜é™åº
});
```

ç­‰ä»·äºä¼ ç»Ÿå†™æ³•ï¼š

```cpp
sort(envelopes.begin(), envelopes.end(), [](const auto& a, const auto& b) {
    if (a[0] != b[0]) return a[0] < b[0];
    return a[1] > b[1];
});
```

ä½†ç°ä»£å†™æ³•æ›´æ¸…æ™°ã€ä¸æ˜“å‡ºé”™ï¼

------

## ğŸ¯ æ€»ç»“

| å‡½æ•°                | å‚æ•°1   | å‚æ•°2              | å‚æ•°3                   |
| ------------------- | ------- | ------------------ | ----------------------- |
| `std::sort`         | `begin` | `end`              | `comp`ï¼ˆå¯é€‰ï¼‰          |
| `std::ranges::sort` | `range` | `comp`ï¼ˆé»˜è®¤ `<`ï¼‰ | `proj`ï¼ˆé»˜è®¤ identityï¼‰ |

> âœ… **è®°ä½**ï¼š
> `ranges::sort(r, comp, proj)` çš„æ¯”è¾ƒé€»è¾‘æ˜¯ï¼š
> **`comp(proj(a), proj(b))`**

ä½ å·²ç»æŒæ¡äº† C++20 æœ€å¼ºå¤§çš„æ’åºå·¥å…·ä¹‹ä¸€ï¼ğŸ‘ è¿™èƒ½è®©ä½ å†™å‡ºæ›´å®‰å…¨ã€æ›´ç®€æ´ã€æ›´é«˜æ•ˆçš„ä»£ç ã€‚